(()=>{"use strict";const e=e=>{const t=document.getElementById("typeItem");(()=>{const n=new Set,a=document.createElement("option");t.innerHTML="",a.value="Все услуги",a.textContent="Все услуги",t.append(a),e.forEach((e=>{n.add(e.type)})),n.forEach((e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.append(n)}))})()},t=e=>{const t=document.getElementById("tbody");t.innerHTML="",e.forEach((e=>{const n=document.createElement("tr");n.classList.add("table__row"),n.innerHTML=`\n        <td class="table__id table__cell">${e.id}</td>\n        <td class="table-type table__cell">${e.type}</td>\n        <td class="table-name table__cell">\n          ${e.name}\n        </td>\n        <td class="table-units table__cell">\n          ${e.units}\n        </td>\n        <td class="table-cost table__cell">\n          ${e.cost} руб\n        </td>\n        <td>\n          <div class="table__actions table__cell">\n            <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change">\n                  <use xlink:href="./img/sprite.svg#change"></use>\n                </svg></span><span>Изменить</span>\n            </button>\n            <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove">\n                  <use xlink:href="./img/sprite.svg#remove"></use>\n                </svg></span><span>Удалить</span>\n            </button>\n          </div>\n        </td>\n      `,t.append(n)}))},n=()=>{const e=document.querySelector(".table__wrapper"),t=document.createElement("div");t.classList.add("message"),t.textContent="Ошибка на сервере. Данные не получены!",e.insertAdjacentElement("afterend",t)},a=()=>{"/table.html"!==window.location.pathname?localStorage.removeItem("auth"):localStorage.getItem("auth")||(window.location.href="/index.html")};window.databaseService=new class{getData(e){return fetch(e).then((e=>e.json())).catch((()=>n()))}sendData(e,t,a){return fetch(e,{method:t,body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).catch((()=>n()))}getServices(){return this.getData("http://localhost:4444/services")}getFilterServices(e,t){return this.getData(`http://localhost:4444/services?${e}=${t}`)}sendNewService(e){return this.sendData("http://localhost:4444/services","POST",e)}getService(e){return this.getData(`http://localhost:4444/services/${e}`)}sendChangeService(e,t){return this.sendData(`http://localhost:4444/services/${e}`,"PUT",t)}requestRemoveService(e){return this.sendData(`http://localhost:4444/services/${e}`,"DELETE")}requestSortService(e){return this.getData(`http://localhost:4444/services?_sort=${e.name}&_order=${e.value}`)}requestSearchService(e){return this.getData(`http://localhost:4444/services?q=${e}`)}},"/table.html"!==window.location.pathname?(a(),(()=>{const e=document.getElementById("login"),t=document.getElementById("name"),n=document.getElementById("type"),a=document.querySelector(".text-warning-name"),s=document.querySelector(".text-warning-password");e.addEventListener("submit",(e=>{e.preventDefault(),fetch("http://localhost:4444/users").then((e=>e.json())).then((e=>(e=>{a.style.display="none",s.style.display="none",e.forEach((e=>{t.value===e.login&&n.value===e.password?(localStorage.setItem("auth",JSON.stringify({auth:!0})),(()=>{let e=new Date(2022,6,4);document.cookie=`name=${t.value}; expires=${e.toUTCString()};`})(),window.location.href="/table.html"):(t.value!==e.login&&(a.style.display="block"),n.value!==e.password&&(s.style.display="block"),t.value="",n.value="")}))})(e)))}))})()):(a(),databaseService.getServices().then((n=>{e(n),t(n)})),document.getElementById("typeItem").addEventListener("change",(e=>{"Все услуги"===e.target.value?databaseService.getServices().then((e=>t(e))):databaseService.getFilterServices("type",e.target.value).then((e=>t(e)))})),(()=>{const n=document.getElementById("modal"),a=document.querySelector(".modal__header"),s=document.getElementById("service"),c=document.getElementById("type"),l=document.getElementById("name"),o=document.getElementById("units"),r=document.getElementById("cost");s.addEventListener("submit",(a=>{a.preventDefault(),s.dataset.service||(()=>{const a={type:c.value,name:l.value,units:o.value,cost:r.value};databaseService.sendNewService(a).then((()=>{databaseService.getServices().then((a=>{e(a),t(a),s.reset(),n.style.display="none"}))}))})()})),document.addEventListener("click",(e=>{e.target.closest(".btn-addItem")?(a.textContent="Добавление новой услуги",n.style.display="flex"):(e.target.closest(".button__close")||e.target.closest(".cancel-button"))&&(n.style.display="none")}))})(),(()=>{const n=document.getElementById("modal"),a=document.querySelector(".modal__header"),s=document.getElementById("service"),c=document.getElementById("type"),l=document.getElementById("name"),o=document.getElementById("units"),r=document.getElementById("cost");s.addEventListener("submit",(a=>{a.preventDefault(),s.dataset.service&&(a=>{const d={type:c.value,name:l.value,units:o.value,cost:r.value};databaseService.sendChangeService(a,d).then((()=>{databaseService.getServices().then((a=>{e(a),t(a),s.reset(),s.removeAttribute("data-service"),n.style.display="none"}))}))})(s.dataset.service)})),document.addEventListener("click",(e=>{e.target.closest(".action-change")?(a.textContent="Редактировать услугу",n.style.display="flex",(e=>{const t=e.querySelector(".table__id").textContent;databaseService.getService(t).then((e=>{c.value=e.type,l.value=e.name,o.value=e.units,r.value=e.cost,s.dataset.service=t}))})(e.target.closest(".table__row"))):(e.target.closest(".button__close")||e.target.closest(".cancel-button"))&&(n.style.display="none")}))})(),document.addEventListener("click",(n=>{n.target.closest(".action-remove")&&(n=>{const a=n.querySelector(".table__id").textContent;databaseService.requestRemoveService(a).then((()=>{databaseService.getServices().then((n=>{e(n),t(n)}))}))})(n.target.closest(".table__row"))})),(()=>{let e=!1;const n=n=>{databaseService.requestSortService({name:n,value:e?"asc":"desc"}).then((e=>{t(e)})),e=!e};document.addEventListener("click",(e=>{e.target.closest(".th-id")?n("id"):e.target.closest(".th-type")?n("type"):e.target.closest(".th-name")?n("name"):e.target.closest(".th-units")&&n("units")}))})(),(()=>{const e=document.getElementById("search"),n=((e,t=300)=>{let n;return(...a)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(void 0,a)}),t)}})((()=>{databaseService.requestSearchService(e.value).then((e=>{t(e)}))}));e.addEventListener("input",n)})())})();